(function(d){var l=0,p=d(document);d.widget("ech.multiselect",{options:{header:true,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:false,multiple:true,position:{},appendTo:"body"},_create:function(){var b=this.element.hide(),a=this.options;this.speed=d.fx.speeds._default;this._isOpen=false;this._namespaceID=this.eventNamespace||"multiselect"+l;b=(this.button=
d('<button type="button"><span class="ui-icon ui-icon-triangle-1-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(a.classes).attr({title:b.attr("title"),"aria-haspopup":true,tabIndex:b.attr("tabIndex")}).insertAfter(b);(this.buttonlabel=d("<span />")).html(a.noneSelectedText).appendTo(b);b=(this.menu=d("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(a.classes).appendTo(d(a.appendTo));var e=(this.header=
d("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(b);(this.headerLinkContainer=d("<ul />")).addClass("ui-helper-reset").html(function(){return a.header===true?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+a.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+a.uncheckAllText+"</span></a></li>":typeof a.header==="string"?
"<li>"+a.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(e);(this.checkboxContainer=d("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(b);this._bindEvents();this.refresh(true);a.multiple||b.addClass("ui-multiselect-single");l++},_init:function(){this.options.header===false&&this.header.hide();this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide();
this.options.autoOpen&&this.open();this.element.is(":disabled")&&this.disable()},refresh:function(b){var a=this.element,e=this.options,c=this.menu,g=this.checkboxContainer,h=[],f="",i=a.attr("id")||l++;a.find("option").each(function(j){d(this);var m=this.parentNode,s=this.innerHTML,q=this.title,t=this.value;j="ui-multiselect-"+(this.id||i+"-option-"+j);var n=this.disabled,r=this.selected,o=["ui-corner-all"],u=(n?"ui-multiselect-disabled ":" ")+this.className,k;if(m.tagName==="OPTGROUP"){k=m.getAttribute("label");
if(d.inArray(k,h)===-1){f+='<li class="ui-multiselect-optgroup-label '+m.className+'"><a href="#">'+k+"</a></li>";h.push(k)}}n&&o.push("ui-state-disabled");r&&!e.multiple&&o.push("ui-state-active");f+='<li class="'+u+'">';f+='<label for="'+j+'" title="'+q+'" class="'+o.join(" ")+'">';f+='<input id="'+j+'" name="multiselect_'+i+'" type="'+(e.multiple?"checkbox":"radio")+'" value="'+t+'" title="'+q+'"';if(r){f+=' checked="checked"';f+=' aria-selected="true"'}if(n){f+=' disabled="disabled"';f+=' aria-disabled="true"'}f+=
" /><span>"+s+"</span></label></li>"});g.html(f);this.labels=c.find("label");this.inputs=this.labels.children("input");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();b||this._trigger("refresh")},update:function(){var b=this.options,a=this.inputs,e=a.filter(":checked"),c=e.length;b=c===0?b.noneSelectedText:d.isFunction(b.selectedText)?b.selectedText.call(this,c,a.length,e.get()):/\d/.test(b.selectedList)&&b.selectedList>0&&c<=b.selectedList?e.map(function(){return d(this).next().html()}).get().join(", "):
b.selectedText.replace("#",c).replace("#",a.length);this._setButtonValue(b);return b},_setButtonValue:function(b){this.buttonlabel.text(b)},_bindEvents:function(){function b(){a[a._isOpen?"close":"open"]();return false}var a=this,e=this.button;e.find("span").bind("click.multiselect",b);e.bind({click:b,keypress:function(c){switch(c.which){case 27:case 38:case 37:a.close();break;case 39:case 40:a.open()}},mouseenter:function(){e.hasClass("ui-state-disabled")||d(this).addClass("ui-state-hover")},mouseleave:function(){d(this).removeClass("ui-state-hover")},
focus:function(){e.hasClass("ui-state-disabled")||d(this).addClass("ui-state-focus")},blur:function(){d(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(c){d(this).hasClass("ui-multiselect-close")?a.close():a[d(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]();c.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(c){c.preventDefault();var g=d(this),h=g.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),
f=h.get();g=g.parent().text();if(a._trigger("beforeoptgrouptoggle",c,{inputs:f,label:g})!==false){a._toggleChecked(h.filter(":checked").length!==h.length,h);a._trigger("optgrouptoggle",c,{inputs:f,label:g,checked:f[0].checked})}}).delegate("label","mouseenter.multiselect",function(){if(!d(this).hasClass("ui-state-disabled")){a.labels.removeClass("ui-state-hover");d(this).addClass("ui-state-hover").find("input").focus()}}).delegate("label","keydown.multiselect",function(c){c.preventDefault();switch(c.which){case 9:case 27:a.close();
break;case 38:case 40:case 37:case 39:a._traverse(c.which,this);break;case 13:d(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(c){var g=d(this),h=this.value,f=this.checked,i=a.element.find("option");if(this.disabled||a._trigger("click",c,{value:h,text:this.title,checked:f})===false)c.preventDefault();else{g.focus();g.attr("aria-selected",f);i.each(function(){if(this.value===h)this.selected=f;else if(!a.options.multiple)this.selected=
false});if(!a.options.multiple){a.labels.removeClass("ui-state-active");g.closest("label").toggleClass("ui-state-active",f);a.close()}a.element.trigger("change");setTimeout(d.proxy(a.update,a),10)}});p.bind("mousedown."+this._namespaceID,function(c){c=c.target;a._isOpen&&c!==a.button[0]&&c!==a.menu[0]&&!d.contains(a.menu[0],c)&&!d.contains(a.button[0],c)&&a.close()});d(this.element[0].form).bind("reset.multiselect",function(){setTimeout(d.proxy(a.refresh,a),10)})},_setButtonWidth:function(){var b=
this.element.outerWidth(),a=this.options;if(/\d/.test(a.minWidth)&&b<a.minWidth)b=a.minWidth;this.button.outerWidth(b)},_setMenuWidth:function(){this.menu.outerWidth(this.button.outerWidth())},_traverse:function(b,a){var e=d(a),c=b===38||b===37;e=e.parent()[c?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[c?"last":"first"]();if(e.length)e.find("label").trigger("mouseover");else{e=this.menu.find("ul").last();this.menu.find("label")[c?"last":"first"]().trigger("mouseover");
e.scrollTop(c?e.height():0)}},_toggleState:function(b,a){return function(){this.disabled||(this[b]=a);a?this.setAttribute("aria-selected",true):this.removeAttribute("aria-selected")}},_toggleChecked:function(b,a){var e=a&&a.length?a:this.inputs,c=this;e.each(this._toggleState("checked",b));e.eq(0).focus();this.update();var g=e.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&d.inArray(this.value,g)>-1&&c._toggleState("selected",b).call(this)});e.length&&
this.element.trigger("change")},_toggleDisabled:function(b){this.button.attr({disabled:b,"aria-disabled":b})[b?"addClass":"removeClass"]("ui-state-disabled");var a=this.menu.find("input");a=b?a.filter(":enabled").data("ech-multiselect-disabled",true):a.filter(function(){return d.data(this,"ech-multiselect-disabled")===true}).removeData("ech-multiselect-disabled");a.attr({disabled:b,"arial-disabled":b}).parent()[b?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:b,"aria-disabled":b})},
open:function(){var b=this.button,a=this.menu,e=this.speed,c=this.options,g=[];if(!(this._trigger("beforeopen")===false||b.hasClass("ui-state-disabled")||this._isOpen)){var h=a.find("ul").last(),f=c.show;if(d.isArray(c.show)){f=c.show[0];e=c.show[1]||this.speed}if(f)g=[f,e];h.scrollTop(0).height(c.height);this.position();d.fn.show.apply(a,g);this.labels.filter(":not(.ui-state-disabled)").eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");b.addClass("ui-state-active");
this._isOpen=true;this._trigger("open")}},close:function(){if(this._trigger("beforeclose")!==false){var b=this.options,a=b.hide,e=this.speed,c=[];if(d.isArray(b.hide)){a=b.hide[0];e=b.hide[1]||this.speed}if(a)c=[a,e];d.fn.hide.apply(this.menu,c);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._isOpen=false;this._trigger("close")}},enable:function(){this._toggleDisabled(false)},disable:function(){this._toggleDisabled(true)},checkAll:function(){this._toggleChecked(true);
this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(false);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){d.Widget.prototype.destroy.call(this);p.unbind(this._namespaceID);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},position:function(){var b=this.options;if(d.ui.position&&
!d.isEmptyObject(b.position)){b.position.of=b.position.of||this.button;this.menu.show().position(b.position).hide()}else{b=this.button.offset();this.menu.css({top:b.top+this.button.outerHeight(),left:b.left})}},_setOption:function(b,a){var e=this.menu;switch(b){case "header":e.find("div.ui-multiselect-header")[a?"show":"hide"]();break;case "checkAllText":e.find("a.ui-multiselect-all span").eq(-1).text(a);break;case "uncheckAllText":e.find("a.ui-multiselect-none span").eq(-1).text(a);break;case "height":e.find("ul").last().height(parseInt(a,
10));break;case "minWidth":this.options[b]=parseInt(a,10);this._setButtonWidth();this._setMenuWidth();break;case "selectedText":case "selectedList":case "noneSelectedText":this.options[b]=a;this.update();break;case "classes":e.add(this.button).removeClass(this.options.classes).addClass(a);break;case "multiple":e.toggleClass("ui-multiselect-single",!a);this.options.multiple=a;this.element[0].multiple=a;this.refresh();break;case "position":this.position()}d.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);
