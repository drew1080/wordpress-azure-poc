(function(a){var j=/[\-\[\]{}()*+?.,\\\^$|#\s]/g;a.widget("ech.multiselectfilter",{options:{label:"Filter:",width:null,placeholder:"Enter keywords",autoReset:false},_create:function(){var b=this.options,h=a(this.element),c=this.instance=h.data("echMultiselect")||h.data("multiselect");this.header=c.menu.find(".ui-multiselect-header").addClass("ui-multiselect-hasfilter");b=this.wrapper=a('<div class="ui-multiselect-filter">'+(b.label.length?b.label:"")+'<input placeholder="'+b.placeholder+'" type="search"'+
(/\d/.test(b.width)?'style="width:'+b.width+'px"':"")+" /></div>").prependTo(this.header);this.inputs=c.menu.find('input[type="checkbox"], input[type="radio"]');this.input=b.find("input").bind({keydown:function(d){d.which===13&&d.preventDefault()},keyup:a.proxy(this._handler,this),click:a.proxy(this._handler,this)});this.updateCache();c._toggleChecked=function(d,i){var e=i&&i.length?i:this.labels.find("input"),f=this;e=e.not(c._isOpen?":disabled, :hidden":":disabled").each(this._toggleState("checked",
d));this.update();var g=e.map(function(){return this.value}).get();this.element.find("option").filter(function(){!this.disabled&&a.inArray(this.value,g)>-1&&f._toggleState("selected",d).call(this)});e.length&&this.element.trigger("change")};b=a(document).bind("multiselectrefresh",a.proxy(function(){this.updateCache();this._handler()},this));this.options.autoReset&&b.bind("multiselectclose",a.proxy(this._reset,this))},_handler:function(b){var h=a.trim(this.input[0].value.toLowerCase()),c=this.rows,
d=this.inputs,i=this.cache;if(h){c.hide();var e=RegExp(h.replace(j,"\\$&"),"gi");this._trigger("filter",b,a.map(i,function(f,g){if(f.search(e)!==-1){c.eq(g).show();return d.get(g)}return null}))}else c.show();this.instance.menu.find(".ui-multiselect-optgroup-label").each(function(){var f=a(this),g=f.nextUntil(".ui-multiselect-optgroup-label").filter(function(){return a.css(this,"display")!=="none"}).length;f[g?"show":"hide"]()})},_reset:function(){this.input.val("").trigger("keyup")},updateCache:function(){this.rows=
this.instance.menu.find(".ui-multiselect-checkboxes li:not(.ui-multiselect-optgroup-label)");this.cache=this.element.children().map(function(){var b=a(this);if(this.tagName.toLowerCase()==="optgroup")b=b.children();return b.map(function(){return this.innerHTML.toLowerCase()}).get()}).get()},widget:function(){return this.wrapper},destroy:function(){a.Widget.prototype.destroy.call(this);this.input.val("").trigger("keyup");this.wrapper.remove()}})})(jQuery);
